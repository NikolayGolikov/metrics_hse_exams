\subsection{ИП, вспомнить всё!}

\begin{enumerate}
\item Найдите длины векторов $a=(1,1,1)$ и $b=(1,4,6)$ и косинус угла между ними. Найдите длину проекции вектора $b$ на вектор $a$.

\item Сформулируйте теорему Фалеса. Сформулируйте и докажите теорему Пифагора.

%\item На плоскости $\alpha$ лежит прямая $\ell$. Вне плоскости $\alpha$ лежит точка $C$. Ромео проецирует точку $C$ на прямую $\ell$ и получает точку $R$. Джульетта проецирует точку $C$ сначала на плоскость $\alpha$, а затем проецирует полученную точку $A$ на прямую $\ell$. После двух действий Джульетта получает точку $D$. Обязательно ли $R$ и $D$ совпадают?

\item Для матрицы

\[
A=\begin{pmatrix}
6 & 5 \\
5 & 6 \\
\end{pmatrix}
\]

\begin{enumerate}
\item Найдите собственные числа и собственные векторы матрицы
\item Найдите $\det (A)$, $\tr(A)$
\item Найдите собственные числа матрицы $A^{2017}$, $\det (A^{2017})$ и $\tr(A^{2017})$
\end{enumerate}

%\item Известно, что $X$ — матрица размера $n \times k$ и $n>k$, известно, что $X'X$ обратима. Рассмотрим матрицу $H=X(X'X)^{-1}X'$. Укажите размер матрицы $H$, найдите $H^{2016}$, $\tr(H)$, $\det(H)$, собственные числа матрицы $H$. Штрих означает транспонирование.

\item Занудная халява: известно, что $\Cov(X, Y)=5$, $\Var(X)=16$, $\Var(Y)=25$, $\E(X)=10$, $\E(Y)=-5$. Найдите $\Cov(X+2Y, Y-X)$, $\Var(X+2Y)$, $\E(X+2Y)$.

\item Блондинка Маша 100 раз выходила на улицу и при этом 40 раз встретила динозавра. Постройте 95\% доверительный интервал для вероятности встретить динозавра. На уровне 5\% проверьте гипотезу о том, что данная вероятность равна $0.5$ против альтернативной гипотезы об отличии данной вероятности от $0.5$.

\item В кошельке 5 монеток, три золотых и две серебряных. Маша берёт наугад две монетки по очереди. Маше достались одинаковые монетки. Какова условная вероятность того, что обе золотые?
\end{enumerate}





\subsection{Контрольная 1, 26.10.2017}



\input{tests/2017_kr_01}

\AMCnumero{1} % начинаем нумерацию вопросов с 1го

\cleargroup{all}
\copygroup[10]{2017_kr_01}{all}
\insertgroup{all}


\subsubsection*{Часть 2. Задачи.}

\begin{enumerate}

\item Докажите, что для модели парной регрессии  $Y_i = \beta_1 + \beta_2 X_i  + \e_i$, оцененной с помощью МНК, сумма остатков регрессии  $e_i=Y_i - \hat{Y}_i$ равна 0.

\item Покажите, что для регрессий $\hat{Y}_i= \hb_1 + \hb_2 X_i$ , $\hat{X}_i = \hat{\alpha}_1 + \hat{\alpha}_2 Y_i$, оценённых по одной и той же выборке $(X_1, Y_1),\ldots, (X_n, Y_n)$ коэффициенты детерминации $R^2$ совпадают, а оценки коэффициентов наклона связаны соотношением $\hb_2 \hat{\alpha}_2 = R^2$.

\item Для классической регрессионной модели $Y_i = \beta_1 + \beta_2 X_i + \e_i , i = 1,\ldots, 20$ известно, что $\sum_{i=1}^{20} X_i = 12, \sum_{i=1}^{20} X_i^2 = 12, \sum_{i=1}^{20} Y_i = 60, \sum_{i=1}^{20} Y_i^2 = 220, \sum_{i=1}^{20} X_i Y_i = 48$. Найдите
\begin{enumerate}
\item $\hb_1, \hb_2$,
\item $TSS$,
\item $ESS$,
\item $\hat\sigma^2_{\varepsilon}$
\end{enumerate}

\item Для предыдущей задачи постройте точечный и 95\% интервальный индивидуальный прогноз в точке $X = 2$.

\item Заполните клетки с точками в приведенной ниже таблице. Клетки с XXX заполнять не надо.

\begin{tabular}{lr} \toprule
Показатель & Значение \\
\midrule
Multiple R          & XXX \\
$R^2$     			& \ldots \\
Standart error 		& XXX \\
Observations		& 60 \\
\bottomrule
\end{tabular}

ANOVA:

\begin{tabular}{lrrrrr} \toprule
      	   	 &  df 	& SS		& MS 	& F & Significance F \\
\midrule
Regression   & 1 	& 0.1  	& 	 	&  	& 		\\
Residual     & 59  	& 0.4  	&     	&  	&     	\\
Total        & 60  	& \ldots  	&    	&  	&     	\\
\bottomrule
\end{tabular}


\begin{tabular}{rrrrrr}
  \hline
 			& Coef. 	& St. error	& t-stat 	& Lower 95\% 	& Upper 95\% \\
  \hline
Intercept 	& 0.0045 	& 0.015 	& XXX 		& XXX 			& XXX \\
MARKET		& 0.56 		& 0.14 		& \ldots 	& \ldots 		& \ldots \\
   \hline
\end{tabular}

\end{enumerate}




\subsection{Контрольная 1, 26.10.2017}

\begin{enumerate}
\item Воспользуемся свойством о том, что в парной рергессии точка $(\bar X, \bar Y)$
лежит на линии выборочной регрессии. Тогда
\begin{align*}
\sum_i e_i &= \sum_i (Y_i - \hat \beta_1 - \hat \beta_2 X_i) \\
\frac{1}{n} \sum_i e_i &= \bar Y_i -  \hat \beta_1 - \hat \beta_2 \bar X = 0 \\
\sum_i e_i &= 0
\end{align*}

\item МНК-оценки в регрессиях будут равны:
\begin{align*}
\hb_2 = \frac{\sum_{i=1}^n (X_i - \overline X)(Y_i - \overline Y)}{\sum_{i=1}^n (X_i - \overline X)^2} \\
\hat\alpha_2 = \frac{\sum_{i=1}^n (Y_i - \overline Y)(X_i - \overline X)}{\sum_{i=1}^n (Y_i - \overline Y)^2}
\end{align*}
Тогда их произведение равно
\begin{multline*}
\hb_2 \hat\alpha_2 = \frac{\sum_{i=1}^n (X_i - \overline X)(Y_i - \overline Y) \cdot \sum_{i=1}^n (Y_i - \overline Y)(X_i - \overline X)}{\sum_{i=1}^n (X_i - \overline X)^2 \cdot \sum_{i=1}^n (Y_i - \overline Y)^2} \\
= \frac{\frac{1}{n-1} \sum_{i=1}^n (X_i - \overline X)(Y_i - \overline Y) \cdot \frac{1}{n-1}  \sum_{i=1}^n (Y_i - \overline Y)(X_i - \overline X)}{\frac{1}{n-1} \sum_{i=1}^n (X_i - \overline X)^2 \cdot \frac{1}{n-1} \sum_{i=1}^n (Y_i - \overline Y)^2} \\
= \frac{\sCov^2(X,Y)}{\sVar(X)\sVar(Y)} = \sCorr^2(X,Y) = R^2
\end{multline*}
Поскольку $\sCorr^2(X,Y) = \sCorr^2(Y,X)$, коэффициенты детерминации в обеих регрессиях равны.

\item
\begin{enumerate}
\item По формулам МНК-оценок получаем:
\begin{align*}
&\hb_2 = \frac{\sum_{i=1}^{20} X_i Y_i - \overline X \sum_{i=1}^{20} Y_i}{\sum_{i=1}^{20} (X_i - \overline X)} = 2.5 \\
&\hb_1 = \overline Y - \hb_2 \overline X = 1.5
\end{align*}
\item $TSS = \sum_{i=1}^{20} (Y_i - \overline Y) = 40$
\item $ESS = \sum_{i=1}^{20} (\hat Y_i - \overline Y) = 30$
\item $\hat\sigma^2_{\varepsilon} = \frac{RSS}{n-k} = \frac{5}{9}$
\end{enumerate}

\item Точечный прогноз:
\[
\hat Y_f = 1.5 + 2.5 \cdot 2 = 6.5
\]
Для индивидуального прогноза понадобится:
\begin{align*}
\widehat{\Var}(Y_f - \hat Y_f) &= \widehat{\Var}(\beta_1 + \beta_2 X_f + \varepsilon_f - \hat Y_f) = \widehat{\Var}(\varepsilon_f - \hat Y_f) = \widehat{\Var}(\varepsilon_f) + \widehat{\Var}(\hat Y_f) \\
&= \hat\sigma^2_{\varepsilon_f} + \widehat{\Var}(\hb_1 + \hb_2 \cdot 2) = \hat\sigma^2_{\varepsilon_f} + \widehat{\Var}(\hb_1) + 4 \widehat{\Var}(\hb_2) + 4 \widehat{\Cov}(\hat \beta_1, \hat \beta_2) \\
&= \hat\sigma^2_{\varepsilon_f} + \frac{\hat\sigma^2_{\varepsilon_f}\sum_{i=1}^{20} X_i^2}{20\sum_{i=1}^{20}(X_i - \overline X)^2} + 4 \cdot \frac{\hat\sigma^2_{\varepsilon_f}}{\sum_{i=1}^{20}(X_i - \overline X)^2} - 4 \cdot \frac{\overline X \hat\sigma^2_{\varepsilon_f}}{\sum_{i=1}^{20}(X_i - \overline X)^2} \\
&\approx 0.81
\end{align*}
Из таблицы для $t_{20-2}$ получаем  $t = 2.1$. И интервальный прогноз примет вид:
\[
[6.5 - 2.1\sqrt{0.81}; 6.5 + 2.1\sqrt{0.81}]
\]
\[
[4.61; 8.39]
\]
\item $R^2 = ESS / TSS = 0.2$

$TSS = RSS + ESS = 0.5$

$t-stat = (0.56 - 0) / 0.14 = 4$

Доверительный интервал: $[0.56 - 2\cdot 0.14; 0.56 + 2\cdot 0.14] = [0.28; 0.84]$, где $t_{60-2;0.975} = 2$.
\end{enumerate}




\subsection{Контрольная 2, 26.10.2017}



\subsubsection*{Часть 1. Тест.}


\input{tests/2017_kr_02_midterm}

\AMCnumero{1} % начинаем нумерацию вопросов с 1го

\cleargroup{all}
\copygroup[10]{2017_kr_02_midterm}{all}
\insertgroup{all}


\subsubsection*{Часть 2. Задачи.}



\begin{enumerate}

\item По 29 наблюдениям оценили функцию спроса на яблоки
\[
\widehat\ln Q = 14 -6 \ln P_{apple} + 3 \ln P_{orange} + 2 \ln P_{banana},
\]
где $Q$ — спрос на яблоки, а $P_{apple}$ — цена яблок, $P_{orange}$ — цена апельсинов и $P_{banana}$ — цена бананов.

Известна оценка ковариационной матрицы коэффициентов регрессии:
\[
\hVar(\hb) =
\begin{pmatrix}
1 & 0.1 & -0.2 & 0.3 \\
0.1 & 2 & 0.5 & 0.7 \\
-0.2 & 0.5 & 3 & 0.6 \\
0.3 & 0.7 & 0.6 &  4
\end{pmatrix}
\]

На уровне значимости 5\% проверьте гипотезу о том, что
$\beta_{orange}=\beta_{banana}$.


\item По ежегодным данным за 25 лет была оценена зависимость расходов на жилье $Y$ от доходов индивидуумов $I$ и относительного индекса цен $P$ с помощью трёх моделей:

$\hY = \underset{(46.9)}{-39.9} + \underset{(0.009)}{0.179} P + \underset{(0.409)}{0.113} I, R^2 = 0.987$

$\hY = \underset{(3.34)}{-27.03} + \underset{(0.004)}{0.177} I, R^2 = 0.987$

$\hY = \underset{(24.2)}{813.3} + \underset{(0.019)}{-7.08} P, R^2 = 0.76$

Известно, что $\hCorr (P, I) = -0.88$, в скобках указаны стандартные отклонения коэффициентов.

Какую модель Вы предпочтёте и почему?


\item Для регрессии в отклонениях $y = \beta_1 x + \beta_2 z + \varepsilon$, оцененной по 100 наблюдениям, известны следующие суммы:
\[
\sum y^2_i = 400, \sum x_i^2 = 30, \sum z_i^2 = 3, \sum x_i y_i = 30, \sum z_i y_i = 24, \sum x_i z_i = 0
\]

Найдите оценки МНК коэффициентов $\beta_1, \beta_2$ и коэффициент детерминации $R^2$.


\item Приведены результаты оценки зависимости логарифма арендной платы жилья в России, lnPRICE, от общей площади,  GENSQUARE (кв. м.), наличия газа, GAS, (1 – есть, 0 – нет), наличия телефона, PHONE (1 – есть, 0 – нет).

Модели 1 и 2 оценены для городов с численностью населения более миллиона человек, модель 3 — для городов с численностью от полумиллиона до миллиона, модель 4 — для обеих выборок. В скобках в таблице приведены стандартные ошибки.

\begin{enumerate}
\item Проверьте значимость коэффициентов в модели 2 при уровне значимости 5\% и дайте интерпретацию полученным результатам.
\item Проверьте гипотезу о равенстве 0.01 коэффициента при переменной GENSQUARE при уровне значимости 0.05 в модели 2.
\item Можно ли утверждать, что наличие газа и телефона в крупном городе не влияет на стоимость аренды? Ответ обоснуйте  формулировкой и проверкой подходящей гипотезы.
\item Опираясь на результаты оценки моделей 2, 3 и 4, можно ли утверждать, что зависимость стоимости жилья от рассмотренных выше факторов едина для с городов с численностью населения более миллиона человек и с численностью от полумиллиона до миллиона? Ответ обоснуйте подходящим тестом.
\end{enumerate}

\begin{tabular}{l c c c c }
\toprule
 & Модель 1 & Модель 2 & Модель 3 & Модель 4 \\
\midrule
(Intercept) & $7.168$      & $6.884$    & $7.459$      & $7.448$    \\
            & $(0.1334)$   & $(0.2398)$ & $(0.059)$   & $(0.0569)$ \\
GENSQUARE   &  $0.012$     & $0.012$    & $0.0064$     & $0.00683$   \\
            & $(0.002687)$ & $(0.0027)$ & $(0.000913)$ & $(0.00086)$ \\
GAS         &              & $0.119$    & $-0.262$      & $-0.272$    \\
            &              & $(0.166)$  & $(0.038)$    & $(0.0354)$  \\
PHONE       &              & $0.197$    & $0.372$      & $0.3505$    \\
            &              & $(0.123)$  & $(0.042)$   & $(0.0399)$  \\
\midrule
$R^2$        & 0.1330         & 0.1541      & 0.177         & 0.1757     \\
F            & 19.95          & 7.78        & 67.37          & 75.75     \\
Adj. $R^2$   & 0.1264         & 0.1343      & 0.175         & 0.1734    \\
Num. obs.    & 132            & 132         & 938           & 1070       \\
RSS          & 23.05          & 22.494      & 309.444       & 334.846    \\
$\hat\sigma$ & 0.42113        & 0.41921     & 0.575        & 0.956    \\
\bottomrule
\end{tabular}


\end{enumerate}

\subsection{Контрольная 2, 26.10.2017, решения}

\begin{enumerate}
\item Для проверки гипотезы используем $t$-статистику:
\[
t_{obs} = \frac{\hb_{orange} - \hb_{banana} - \beta_{orange} - \beta_{banana}}{se(\hb_{orange} - \hb_{banana})} \sim t_{n-k} = t_{29 -4} = t_{25}
\]
Сначала найдём стандартное отклонение:
\begin{align*}
\widehat{se}(\hb_{orange} - \hb_{banana}) &= \sqrt{\widehat{\Var}(\hb_{orange}) + \widehat{\Var}(\hb_{banana}) - 2 \widehat{\Cov}(\hb_{orange}, \hb_{banana})} \\
&= \sqrt{3 + 4 - 2\cdot 0.6} \approx 2.41
\end{align*}
Тогда наблюдаемое значение статистики равно $t_{obs} = \frac{3-4}{2.41} \approx -0.42$,
а $t_{crit} \approx 2.06$. Значит, оснований отвергать нулевую гипотезу нет.
\item В модели (1) $\widehat{\Corr}(P,I)=-0.8$ свидетельствует о проблеме мультиколлинеарности в данных.
В модели (3) значение $R^2$ самое низкое. Предпчтительной является модель $(2)$.
\item Заметим, что
\begin{align*}
\sum x_i y_i &= \sCov(X,Y) = 30 \\
\sum x_i z_i &= \sCov(Z,Y) = 20 \\
\sum x_i^2 &= \sVar(X) = 30 \\
\sum z_i^2 &= \sVar(Z) = 3 \\
\sum y_i^2 &= \sVar(Y) = \frac{493}{3} \\
\end{align*}
Тогда соответствующие коэффициенты равны:
\begin{align*}
\hat \beta_1 &= \frac{\sCov(X,Y)}{\sVar(X)} = \frac{30}{30} = 1 \\
\hat \beta_2 &= \frac{\sCov(Z,Y)}{\sVar(Z)} = \frac{20}{3}
\end{align*}
Для нахождения коэффициента детерминации воспользуемся факторным разложением:
\[
R^2 = \hb_1 \frac{\sCov(X,Y)}{\sVar(Y)} + \hb_2 \frac{\sCov(Z,Y)}{\sVar(Y)} = 1 \cdot \frac{30}{\frac{493}{3}} + \frac{20}{3} \cdot \frac{20}{\frac{493}{3}} = \frac{490}{493}
\]
\item
\begin{enumerate}
\item $n=132$, $k=3 \Rightarrow n-k = 128$, в таблице находим,
что при $\alpha = 0.05$ $t_{crit} = 1.98$.

$t_{obs} = \frac{6.884 - 0}{0.2398} = 28.7 > t_{crit} \Rightarrow \hat \beta_{Intercept}$ значим.

$t_{obs} = \frac{0.012 - 0}{0.0027} = 4.(4) > t_{crit} \Rightarrow \hat \beta_{GENSQUARE}$ значим.

$t_{obs} = \frac{0.119 - 0}{0.166} = 0.72 < t_{crit} \Rightarrow \hat \beta_{GAS}$ незначим.

$t_{obs} = \frac{0.197 - 0}{0.123} = 1.6 < t_{crit} \Rightarrow \hat \beta_{PHONE}$ незначим.

При прочих равных общая площадь оказывает влияние на логарифм арендной платы,
а наличие газа и наличие телефона — нет.
\item При верной $H_0$ и $\alpha = 0.1$ $t_{crit} = 1.658$.
\[
t_{obs} = \frac{0.199 - 0.02}{0.166} = -0.596
\]
Поскольку $|t_{obs}| < t_{crit}$, оснований отвергать нулевую гипотезу нет.
\item
\[H_0:
\begin{cases}
  \beta_{GAS} = 0 \\
  \beta_{PHONE} = 0
\end{cases}
\qquad
H_a: \beta_{GAS}^2 + \beta_{PHONE}^2 > 0
\]
Выпишем ограниченную и неограниченную модели:
\begin{multline*}
R: lnPRICE_i = \beta_{Intercept} + \beta_{GENSQUARE} GENSQUARE_i + \varepsilon_i \\
UR: lnPRICE_i = \beta_{Intercept} + \beta_{GENSQUARE} GENSQUARE_i + \beta_{GAS} GAS_i \\
+ \beta_{PHONE} PHONE_i + \varepsilon_i
\end{multline*}
Из условия находим: $RSS_{R} = 23.05$, $RSS_{UR} = 22.494$.

При верной $H_0$ $F \sim F_{2, 128}$ и $F_{crit} \approx 3.8$ ($\alpha = 0.05$).
\[
F_{obs} = \frac{(RSS_R - RSS_{UR}) / q}{RSS_{UR}/(n - k_{UR})} = \frac{(23.05 - 22.494) / 2}{22.494 / (132 - 4)} = 1.58
\]
Так как $F_{obs} < F_{crit}$, нет оснований отвергать $H_0$.
\item Чтобы записать неограниченную модель, введём вспомогательную переменную
\[
d_i = \begin{cases}
1, & \text{если город крупный} \\
0, & \text{иначе}
\end{cases}
\]
Тогда неограниченная модель примет вид:
\begin{multline*}
lnPRICE_i = (\beta_{Intercept} + \Delta_1 di) + (\beta_{GENSQUARE} + \Delta_2 d_i) GENSQUARE_i \\
+ (\beta_{GAS} + \Delta_3 d_i) GAS_i + (\beta_{PHONE} + \Delta_4 d_i) PHONE_i + \varepsilon_i \\
RSS_{UR} = 22.494 + 616.709 = 639.203
\end{multline*}
Выпишем также ограниченную модель:
\begin{multline*}
lnPRICE_i = \beta_{Intercept} + \beta_{GENSQUARE} GENSQUARE_i + \beta_{GAS} GAS_i \\
+ \beta_{PHONE} PHONE_i + \varepsilon_i \\
RSS_{R} = 710.21
\end{multline*}
Проверятеся следующая гипотеза:
\[H_0:
\begin{cases}
  \Delta_1 = 0 \\
  \Delta_2 = 0 \\
  \Delta_3 = 0 \\
  \Delta_4 = 0 \\
\end{cases}
\qquad
H_a: \Delta_1^2 + \Delta_2^2 + \Delta_3^2+ \Delta_4^2 > 0
\]
При верной $H_0$ $F \sim F_{4, 1173}$ и $F_{crit} \approx 2.8$ ($\alpha = 0.05$).
\[
F_{obs} = \frac{(RSS_R - RSS_{UR}) / q}{RSS_{UR}/(n - k_{UR})} = \frac{(710.21 - 639.203)/4}{639.203/(1181-8)} \approx 32.58
\]
Поскольку $F_{obs} > F_{crit}$, основная гипотеза отвергается,
а значит, зависимость нельзя считать единой.
\end{enumerate}
\end{enumerate}
